
{
  "entities": {
    "Temple": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Temple",
      "type": "object",
      "description": "Represents a temple registered on the platform.",
      "properties": {
        "templeName": {
          "type": "string",
          "description": "Name of the temple."
        },
        "description": {
          "type": "string",
          "description": "Description of the temple."
        },
        "address": {
          "type": "string",
          "description": "Street address of the temple."
        },
        "city": {
          "type": "string",
          "description": "City where the temple is located."
        },
        "state": {
          "type": "string",
          "description": "State or province where the temple is located."
        },
        "zipCode": {
          "type": "string",
          "description": "ZIP or postal code for the temple's address."
        },
        "contactEmail": {
          "type": "string",
          "description": "Contact email address of the temple.",
          "format": "email"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the temple's image.",
          "format": "uri"
        },
        "poojas": {
          "type": "array",
          "description": "A list of poojas offered by the temple.",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "description": {
                "type": "string"
              },
              "price": {
                "type": "number"
              }
            },
            "required": ["name", "price", "description"]
          }
        },
        "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp when the temple was registered."
        }
      },
      "required": [
        "templeName",
        "description",
        "address",
        "city",
        "state",
        "zipCode",
        "contactEmail",
        "imageUrl"
      ]
    },
    "Pooja": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pooja",
      "type": "object",
      "description": "Represents a pooja offered by a temple.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the pooja."
        },
        "templeId": {
          "type": "string",
          "description": "Reference to Temple. (Relationship: Temple 1:N Pooja)"
        },
        "name": {
          "type": "string",
          "description": "Name of the pooja."
        },
        "description": {
          "type": "string",
          "description": "Description of the pooja."
        },
        "schedule": {
          "type": "string",
          "description": "Schedule of the pooja (e.g., date and time).",
          "format": "date-time"
        },
        "price": {
          "type": "number",
          "description": "Price of the pooja."
        }
      },
      "required": [
        "id",
        "templeId",
        "name",
        "description",
        "schedule",
        "price"
      ]
    },
    "Donation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Donation",
      "type": "object",
      "description": "Represents a donation made to a temple.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the donation."
        },
        "templeId": {
          "type": "string",
          "description": "Reference to Temple. (Relationship: Temple 1:N Donation)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Donation)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the donation."
        },
        "donationDate": {
          "type": "string",
          "description": "Date and time of the donation.",
          "format": "date-time"
        },
        "transactionId": {
          "type": "string",
          "description": "Transaction ID from the payment gateway."
        }
      },
      "required": [
        "id",
        "templeId",
        "userId",
        "amount",
        "donationDate",
        "transactionId"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product (prasad or religious item) sold by a temple.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "templeId": {
          "type": "string",
          "description": "Reference to Temple. (Relationship: Temple 1:N Product)"
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product's image.",
          "format": "uri"
        },
        "stockQuantity": {
          "type": "number",
          "description": "Number of units currently in stock."
        }
      },
      "required": [
        "id",
        "templeId",
        "name",
        "description",
        "price",
        "imageUrl",
        "stockQuantity"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription plan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 Subscription)"
        },
        "planType": {
          "type": "string",
          "description": "Type of subscription plan (e.g., Free, Premium)."
        },
        "startDate": {
          "type": "string",
          "description": "Date when the subscription started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "Date when the subscription ends.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the subscription (e.g., Active, Inactive)."
        }
      },
      "required": [
        "id",
        "userId",
        "planType",
        "startDate",
        "endDate",
        "status"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/temples/{templeId}",
        "definition": {
          "entityName": "Temple",
          "schema": {
            "$ref": "#/entities/Temple"
          },
          "description": "Stores information about registered temples. Includes the temple's contact details, address, and image URL.",
          "params": [
            {
              "name": "templeId",
              "description": "Unique identifier for the temple."
            }
          ]
        }
      },
      {
        "path": "/temples/{templeId}/poojas/{poojaId}",
        "definition": {
          "entityName": "Pooja",
          "schema": {
            "$ref": "#/entities/Pooja"
          },
          "description": "Stores information about poojas offered by a specific temple. Includes denormalized 'templeId' for authorization independence.",
          "params": [
            {
              "name": "templeId",
              "description": "Unique identifier for the temple offering the pooja."
            },
            {
              "name": "poojaId",
              "description": "Unique identifier for the pooja."
            }
          ]
        }
      },
      {
        "path": "/temples/{templeId}/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/entities/Product"
          },
          "description": "Stores information about products (prasad, religious items) sold by a temple. Includes denormalized 'templeId' for authorization independence.",
          "params": [
            {
              "name": "templeId",
              "description": "Unique identifier for the temple selling the product."
            },
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/donations/{donationId}",
        "definition": {
          "entityName": "Donation",
          "schema": {
            "$ref": "#/entities/Donation"
          },
          "description": "Stores information about donations made to temples. This is a top-level collection because it relates Users and Temples. The `userId` identifies the donor and the `templeId` identifies the receiving temple. Includes denormalized `templeId` and `userId` for authorization independence.",
          "params": [
            {
              "name": "donationId",
              "description": "Unique identifier for the donation."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/entities/User"
          },
          "description": "Stores user profile information.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/entities/Subscription"
          },
          "description": "Stores user subscription information. Enforces path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "subscriptionId",
              "description": "Unique identifier for the subscription."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and easily debuggable, adhering to the core principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). It incorporates denormalization where necessary to avoid hierarchical authorization dependencies, and segregates data based on access needs to maintain a homogeneous security posture.\n\n**Authorization Independence:** The structure avoids using `get()` calls in security rules by denormalizing authorization data. For example, if access to `Pooja`, `Donation`, and `Product` documents depends on temple ownership, the `Temple`'s relevant attributes (e.g., a `managers` map containing user IDs and their roles) would be copied into the `Pooja`, `Donation`, and `Product` documents.\n\n**Structural Segregation:** The data is separated into collections based on their security requirements. User-specific data (e.g., Subscriptions) is stored under the `/users/{userId}` path, while temple-owned data is stored under `/temples/{templeId}` path. This segregation simplifies security rules and improves maintainability.\n\n**Access Modeling:** Path-based ownership is used for user-owned data (e.g., `/users/{userId}/subscriptions/{subscriptionId}`). For collaborative data (e.g., access to temple-related collections), the structure can support a membership map (although not explicitly defined in this version since roles are not specified), denormalizing membership data to child collections if more complex access rules are needed beyond simple temple ownership.\n\n**QAPs (Rules are not Filters):** The segregation of data into different collections based on access needs and the use of path-based ownership and membership maps (when needed) ensures that list operations can be secured effectively without filtering on the client-side. The separation of concerns into distinct collections minimizes the need for complex rule logic and makes securing queries straightforward.\n\n**Example Scenario:**\n\n*   A temple registers and creates Pooja offerings. The temple data is stored in `/temples/{templeId}`. The Pooja offerings are stored in `/temples/{templeId}/poojas/{poojaId}`. The pooja documents would include the `templeId`, allowing security rules to easily check if the requesting user has the correct permissions to access or modify the pooja."
  }
}
